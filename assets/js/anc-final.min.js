"use strict";function Game(e){this.gameManager_=e,dev&&(this.debugUi=new cast.receiver.games.debug.DebugUI(e))}function loadScriptsNoCache(e){if(0!=e.length){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e.shift()+"?ts="+Date.now()),a.onload=function(){loadScriptsNoCache(e)},document.getElementsByTagName("head")[0].appendChild(a)}}var app=angular.module("AskNCast",["AskNCast.services","ui.router","ngMaterial"]),dev=!0;app.config(["$stateProvider","$urlRouterProvider",function(e,a){a.otherwise("/"),e.state("leaderboard",{templateUrl:"views/leaderboard.html"}).state("question",{templateUrl:"views/question.html"})}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("grey",{"default":"900"}).accentPalette("red").dark()}]),Game.prototype.run=function(e){this.gameManager_.updateGameplayState(cast.receiver.games.GameplayState.RUNNING,null),e()},Game.prototype.setDebugUi=function(e){e?this.debugUi.open():this.debugUi.close()},Game.prototype.setGameData=function(e){this.gameManager_.updateGameData(e)},Game.prototype.chooseRandomQuestioner=function(e,a,t){var n=_.shuffle(e)[0];a.phase=t.CHOOSING,a.questioner=n.playerData.name,a.questioner_id=n.playerId,a.questioner_avatar=n.playerData.avatar,a.skip_avail=!1,this.setGameData(a)},Game.prototype.setQuestion=function(e,a,t){a.phase=t.VOTING,a.question=e,a.skip_avail=!1,this.setGameData(a)},Game.prototype.stop=function(){},loadScriptsNoCache(["https:///www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js","https://www.gstatic.com/cast/sdk/libs/games/1.0.0/cast_games_receiver.js"]),app.controller("leaderboardController",["$scope","cast",function(e,a){}]),app.controller("mainController",["$scope","$log","$window","$timeout","$state","cast",function(e,a,t,n,s,o){e.window=t,e.connected=0,e.sessionCount=0;var i,r="https://api.adorable.io/avatars/50/";e.players=[];var c={DEBUG_UI:"debugUI",QUESTION:"question",VOTE:"vote",SKIP:"skip"},u={CHOOSING:"choosing",VOTING:"voting"};e.gameData={phase:null,question:"",questioner:"",questioner_id:"",questioner_avatar:"",skip_avail:!1};var p=function(){0==e.connected&&o.finish()};e.$on(o.SENDER_CONNECTED,function(t,s){a.info("Sender connected: "+JSON.stringify(s)),i&&(e.idle=!1,n.cancel(i),i=null),e.connected++,e.sessionCount++}),e.$on(o.SENDER_DISCONNECTED,function(a,t){e.connected--,0==e.connected&&(e.getSessionCount()<=0?o.finish():(e.idle=!0,i&&n.cancel(i),i=n(p,1e4)))}),e.getSessionCount=function(){return e.sessionCount},e.$on(o.PLAYER_AVAILABLE,function(t,n){dev&&a.debug(n),e.players=e.players.filter(function(e){return e.playerId!==n.playerInfo.playerId}),e.players.push(n.playerInfo),o.game.gameManager_.updatePlayerData(n.playerInfo.playerId,{name:n.requestExtraMessageData.name,score:0,avatar:r+n.playerInfo.playerId+".png"}),null==e.gameData.phase&&1==e.players.length&&o.game.chooseRandomQuestioner(e.players,e.gameData,u)}),e.$on(o.PLAYER_QUIT,function(e,t){dev&&a.debug(t)}),e.$on(o.PLAYER_DROPPED,function(e,t){dev&&a.debug(t)}),e.$on(o.GAME_MESSAGE_RECEIVED,function(t,n){switch(dev&&a.debug(n),n.requestExtraMessageData.type){case c.DEBUG_UI:dev&&o.game.setDebugUi(n.requestExtraMessageData.toggle);break;case c.QUESTION:e.gameData.phase==u.CHOOSING&&e.gameData.questioner_id==n.playerInfo.playerId&&o.game.setQuestion(n.requestExtraMessageData.question,e.gameData,u);break;case c.VOTE:e.gameData==u.VOTING;break;case c.SKIP:e.gameData.skip_avail}}),e.$watch("gameData.phase",function(e,a){switch(e){case null:break;case u.CHOOSING:s.go("leaderboard");break;case u.VOTING:s.go("question")}})}]),app.controller("questionController",["$scope","cast",function(e,a){}]),angular.module("AskNCast.services",[]).service("cast",["$window","$rootScope","$q",function(e,a,t){this.game=null,this.appName="AskNCast";var n,s=this;this.SENDER_CONNECTED="sender-connected",this.SENDER_DISCONNECTED="sender-disconnected",this.PLAYER_AVAILABLE="player-available",this.PLAYER_QUIT="player-quit",this.PLAYER_DROPPED="player-dropped",this.GAME_MESSAGE_RECEIVED="game-message-received";var o=function(){n=e.cast.receiver.CastReceiverManager.getInstance();var t=new e.cast.receiver.CastReceiverManager.Config;t.statusText=s.appName+" ready.",t.maxInactivity=6e3;var o=new e.cast.receiver.games.GameManagerConfig;o.applicationName=s.appName,o.maxPlayers=10;var i=new e.cast.receiver.games.GameManager(o);s.game=new Game(i);var r=function(){s.game.run(function(){console.log(o.applicationName+" running."),i.updateGameStatusText(o.applicationName+" running.")})};n.onSenderConnected=function(e){a.$apply(function(){a.$broadcast(s.SENDER_CONNECTED,e)})},n.onSenderDisconnected=function(e){a.$apply(function(){a.$broadcast(s.SENDER_DISCONNECTED,e)})},i.addEventListener(cast.receiver.games.EventType.PLAYER_AVAILABLE,function(e){a.$apply(function(){a.$broadcast(s.PLAYER_AVAILABLE,e)})}),i.addEventListener(cast.receiver.games.EventType.PLAYER_QUIT,function(e){a.$apply(function(){a.$broadcast(s.PLAYER_QUIT,e)})}),i.addEventListener(cast.receiver.games.EventType.PLAYER_DROPPED,function(e){a.$apply(function(){a.$broadcast(s.PLAYER_DROPPED,e)})}),i.addEventListener(cast.receiver.games.EventType.GAME_MESSAGE_RECEIVED,function(e){a.$apply(function(){a.$broadcast(s.GAME_MESSAGE_RECEIVED,e)})}),n.onReady=function(e){r()},n.start(t)};this.boot=function(){"complete"===document.readyState?o():e.onload=o},this.finish=function(){n.stop()}}]).run(["cast",function(e){e.boot()}]);